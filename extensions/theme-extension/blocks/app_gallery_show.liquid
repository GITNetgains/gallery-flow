{% comment %}
  Product Gallery Block - Multi-Purpose with Layout Options and Merchant Styling
{% endcomment %}

<div id="content-gallery-block" style="padding:5px;">
  <div id="gallery-images" class="gallery-grid" style="
    margin-top:20px;
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    justify-content:center;
  ">
    <div style="width:100%; text-align:center; color:#666;">
      Loading gallery...
    </div>
  </div>
</div>

<script>
  // ----------------------------------------
  // Content ID Detection (Safe with Liquid)
  // ----------------------------------------
  {% case block.settings.gallery_type %}
    {% when 'product' %}
      {% if product %}
        window.contentId = "{{ product.id }}";
        window.contentType = "product";
      {% else %}
        window.contentId = "";
        window.contentType = "";
      {% endif %}
    {% when 'collection' %}
      {% if collection %}
        window.contentId = "{{ collection.id }}";
        window.contentType = "collection";
      {% else %}
        window.contentId = "";
        window.contentType = "";
      {% endif %}
    {% when 'article' %}
      {% if article %}
        window.contentId = "{{ article.id }}";
        window.contentType = "article";
      {% else %}
        window.contentId = "";
        window.contentType = "";
      {% endif %}
    {% when 'page' %}
      {% if page %}
        window.contentId = "{{ page.id }}";
        window.contentType = "page";
      {% else %}
        window.contentId = "";
        window.contentType = "";
      {% endif %}
    {% else %}
      window.contentId = "";
      window.contentType = "";
  {% endcase %}

  console.log("Gallery Debug â†’", {
    type: window.contentType,
    id: window.contentId
  });

  // ----------------------------------------
  // Gallery Loader (API Fetch Example)
  // ----------------------------------------
  async function loadGallery() {
    const container = document.getElementById("gallery-images");
    if (!window.contentId) {
      container.innerHTML = `<div style="color:#c00;">No content ID found for this block.</div>`;
      return;
    }

    try {
      const res = await fetch(`/apps/gallery?contentId=${window.contentId}&type=${window.contentType}`);
      if (!res.ok) throw new Error("Failed to fetch gallery");

      const data = await res.json();
      if (!data || !data.images || !data.images.length) {
        container.innerHTML = `<div style="color:#666;">No gallery images available.</div>`;
        return;
      }

      container.innerHTML = data.images.map(img =>
        `<div style="flex:1 1 200px; max-width:300px;">
          <img src="${img.url}" alt="" style="width:100%; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.15);" />
        </div>`
      ).join("");
    } catch (err) {
      console.error("Gallery Load Error:", err);
      container.innerHTML = `<div style="color:#c00;">Error loading gallery.</div>`;
    }
  }

  document.addEventListener("DOMContentLoaded", loadGallery);
</script>

{% schema %}
{
  "name": "Show Gallery",
  "target": "section",
  "settings": [
    {
      "type": "select",
      "id": "gallery_type",
      "label": "Select Content Type",
      "options": [
        { "value": "product", "label": "Product" },
        { "value": "collection", "label": "Collection" },
        { "value": "article", "label": "Blog Article" },
        { "value": "page", "label": "Page" }
      ],
      "default": "product"
    },
    {
      "type": "select",
      "id": "gallery_layout",
      "label": "Gallery Layout",
      "options": [
        { "value": "grid", "label": "Grid" },
        { "value": "carousel", "label": "Carousel" },
        { "value": "masonry", "label": "Masonry" }
      ],
      "default": "grid"
    },
    {
  "type": "select",
  "id": "object_fit",
  "label": "Image Fit (object-fit)",
  "options": [
    { "value": "cover", "label": "Cover" },
    { "value": "contain", "label": "Contain" }
  ],
  "default": "contain"
},
    {
      "type": "range",
      "id": "border_radius",
      "label": "Border Radius (px)",
      "min": 0,
      "max": 20,
      "step": 1,
      "default": 4
    },
    {
      "type": "checkbox",
      "id": "box_shadow",
      "label": "Enable Box Shadow",
      "default": true
    },
    {
      "type": "text",
      "id": "image_height",
      "label": "Image Height (for grid/carousel)",
      "default": "200px",
      "info": "Masonry layout uses natural image heights"
    },
    {
      "type": "textarea",
      "id": "custom_css",
      "label": "Custom CSS",
      "info": "Add any custom CSS here. Use #content-gallery-block as the root selector."
    }
  ],
  "enabled_on": {
    "templates": ["product", "collection", "article", "page"]
  }
}
{% endschema %}