{% comment %}
  Photo Gallery App Block with Enhanced Custom CSS Section
{% endcomment %}

<div id="app-gallery" class="Polaris-Page" style="padding:10px; font-size:14px; line-height:1.4;">
  <div class="Polaris-Card" style="padding:10px;">
    <div class="Polaris-Card__Section" style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap;">
      <div style="max-width:600px;">
        <h1 class="Polaris-Text--headingXl" style="margin-bottom:10px; font-size:{{ block.settings.heading_size }}px; color:{{ block.settings.heading_color }};">
          {{ block.settings.heading_text }}
        </h1>
        <p style="font-size:{{ block.settings.subtext_size }}px; color:{{ block.settings.subtext_color }};">
          {{ block.settings.subtext }}
        </p>
      </div>
      <button id="upload-gallery-button" class="Polaris-Button Polaris-Button--primary" style="background:{{ block.settings.button_bg_color }}; color:{{ block.settings.button_text_color }}; padding:10px 16px; border-radius:6px; font-weight:bold; font-size:{{ block.settings.button_text_size }}px;">
        {{ block.settings.button_text }}
      </button>
    </div>

    <!-- Hidden modals -->
    <div id="login-modal-container" style="display:none;">
      {% render 'login-modal', button_bg_color: block.settings.button_bg_color, button_text_color: block.settings.button_text_color %}
    </div>
    <div id="upload-gallery-modal-container" style="display:none;">
      {% render 'upload-gallery-modal', button_bg_color: block.settings.button_bg_color, button_text_color: block.settings.button_text_color %}
    </div>
  </div>
</div>

<style>
  /* Base Styles */
  #app-gallery {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    max-width: 1200px;
    margin: 0 auto;
  }

  #app-gallery .Polaris-Card {
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    overflow: hidden;
  }

  #app-gallery .Polaris-Button {
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
    min-height: 36px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  /* Merchant Custom CSS */
  {% if block.settings.enable_custom_css %}
    {{ block.settings.custom_css }}
  {% endif %}
</style>

<script>

document.addEventListener("DOMContentLoaded", async function() {
  const uploadButton = document.getElementById("upload-gallery-button");
  const loginModalContainer = document.getElementById("login-modal-container");
  const uploadGalleryModalContainer = document.getElementById("upload-gallery-modal-container");
  const galleriesContainer = document.getElementById("approved-galleries-container");
  const typeFilterContainer = document.getElementById("type-filter-container");

  window.customerData = {
    id: {{ customer.id | json }},
    email: {{ customer.email | json }},
    first_name: {{ customer.first_name | json }},
    last_name: {{ customer.last_name | json }}
  };

  // Modal open logic
  if (uploadButton) {
    uploadButton.addEventListener("click", function() {
    
      if (window.customerData?.email) {
        uploadGalleryModalContainer.style.display = "block";
      } else {
        window.location.href = "/account/login";
      }
    });
  }

  try {
    // Fetch all approved images from your API
    const res = await fetch("https://gallery-flow-two.vercel.app/api/galleries");
    const data = await res.json();

    const images = data.images || [];

    // Remove filter container since no filtering needed
    if (typeFilterContainer) {
      typeFilterContainer.style.display = "none";
    }

    // Render all images
    renderImages(images);

  } catch (error) {
    console.error("Error fetching data:", error);
    galleriesContainer.innerHTML = "<p>Error loading images.</p>";
  }

  function renderImages(images) {
    galleriesContainer.innerHTML = "";
    if (images.length === 0) {
      galleriesContainer.innerHTML = "<p>No approved images found.</p>";
      return;
    }

    images.forEach((img) => {
      const imageEl = document.createElement("img");
      imageEl.src = `https://gallery-flow-two.vercel.app${img.url}`;
      imageEl.alt = `Uploaded image ${img.id}`;
      imageEl.style.width = "100%";
      imageEl.style.borderRadius = "8px";
      imageEl.style.boxShadow = "0 1px 3px rgba(0,0,0,0.2)";
      imageEl.style.maxWidth = "300px";
      imageEl.style.minWidth = "250px";
      galleriesContainer.appendChild(imageEl);
    });
  }
});


</script>




{% schema %}
{
  "name": "Upload Gallery",
  "target": "section",
  "settings": [
    {
      "type": "header",
      "content": "Heading Settings"
    },
    {
      "type": "text",
      "id": "heading_text",
      "label": "Heading Text",
      "default": "Get Featured in Our Gallery!"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 20,
      "max": 60,
      "step": 1,
      "unit": "px",
      "label": "Heading Font Size",
      "default": 45
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Subtext Settings"
    },
    {
      "type": "textarea",
      "id": "subtext",
      "label": "Subtext Content",
      "default": "Upload your event images featuring our products, and get a chance to be showcased on our website."
    },
    {
      "type": "range",
      "id": "subtext_size",
      "min": 10,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Subtext Font Size",
      "default": 15
    },
    {
      "type": "color",
      "id": "subtext_color",
      "label": "Subtext Color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Button Settings"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Upload Gallery"
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "Button Background Color",
      "default": "#ff4d4f"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "button_text_size",
      "min": 10,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Button Font Size",
      "default": 13
    },
    {
      "type": "header",
      "content": "Custom CSS"
    },
    {
      "type": "checkbox",
      "id": "enable_custom_css",
      "label": "Enable Custom CSS",
      "default": true
    },
    {
      "type": "textarea",
      "id": "custom_css",
      "label": "Custom CSS",
      "info": "Add custom CSS rules. Use #app-gallery  as the root selector.",
      "default": "#app-gallery .Polaris-Button {\n  border: 2px solid #000000;\n}"
    }
  ]
}
{% endschema %}
